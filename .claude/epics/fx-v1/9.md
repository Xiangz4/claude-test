---
id: 9
epic: fx-v1
title: 实现汇率计算引擎和配置管理
status: open
created: 2025-11-11T15:29:47Z
updated: 2025-11-11T16:07:01Z
parallel: false
depends_on: [7]
conflicts_with: []
effort: M
estimated_days: 2-3
---

# Task 9: 实现汇率计算引擎和配置管理

## Description

实现三层汇率计算逻辑（通道汇率→平台标价汇率→商户定价汇率），开发平台和商户汇率配置API，实现规则引擎支持Pips和百分比加点

## Parallel Execution

**Cannot run in parallel** - Depends on Task 002汇率采集

## Dependencies

- **Depends on:** [7] 实现通道汇率采集系统

## Conflicts

None

## Acceptance Criteria

- [ ] 汇率计算引擎实现并通过单元测试
- [ ] 支持Pips和百分比两种加点模式
- [ ] 支持反向币种对自动推算（如USD/HKD → HKD/USD）
- [ ] 平台标价汇率配置API实现（CRUD）
- [ ] 商户定价汇率配置API实现（CRUD）
- [ ] 商户报价锁定API实现（Redis TTL 30秒）
- [ ] 汇率计算时校验不低于通道汇率（防止亏损）

## Technical Details

- 实现calculateMerchantRate函数
- 规则配置存储为JSON格式
- 报价锁定使用Redis SETEX命令
- 反向汇率计算：1 / 正向汇率
- 配置变更记录操作人和时间

## Effort Estimate

**Size:** M (Medium)
**Duration:** 2-3天
**Parallel:** false
