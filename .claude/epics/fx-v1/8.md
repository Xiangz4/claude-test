---
number: 8
title: 实现通道服务和资金调拨
status: open
created: 2025-11-11T15:29:47Z
updated: 2025-11-11T16:07:02Z
parallel: false
depends_on: [3]
conflicts_with: []
---

# Task 8: 实现通道服务和资金调拨

## Description

实现PHP和Leptage通道的换汇询价、下单、转账功能，实现资金调拨逻辑（平台↔通道），实现异常处理和重试机制

## Acceptance Criteria

- [ ] PHP通道适配器实现询价、下单、查询接口
- [ ] Leptage通道适配器实现询价、换汇、转账接口
- [ ] 通道管理器实现故障切换逻辑
- [ ] 资金调拨API实现（调用Lazza Account扩展接口）
- [ ] 数字货币换汇需先调拨本金到通道
- [ ] 法币换汇只需调拨手续费到通道
- [ ] 异常重试机制实现（指数退避，最多3次）
- [ ] 通道调用失败记录详细日志

## Technical Details

- PHP通道使用prefund实时下单模式
- Leptage需要先调用转账API调拨资金
- 实现ChannelManager统一管理多个适配器
- 重试使用@nestjs/bull实现延迟队列
- 记录通道请求/响应日志用于追溯

## Estimated Effort

L - 3-5天

## Dependencies

This task depends on:
- Task 3: 搭建微服务基础架构和数据库模型

This task cannot run in parallel with its dependencies.
