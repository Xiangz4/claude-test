---
id: 7
epic: fx-v1
title: 实现通道汇率采集系统
status: open
created: 2025-11-11T15:29:47Z
updated: 2025-11-11T16:07:01Z
parallel: false
depends_on: [3]
conflicts_with: []
effort: M
estimated_days: 2-3
---

# Task 7: 实现通道汇率采集系统

## Description

实现PHP、BOCHK、Leptage三个通道的汇率采集适配器，创建定时Cron Job每分钟采集汇率，实现汇率存储和缓存逻辑

## Parallel Execution

**Cannot run in parallel** - Depends on Task 001基础架构

## Dependencies

- **Depends on:** [3] 搭建微服务基础架构和数据库模型

## Conflicts

None

## Acceptance Criteria

- [ ] PHP通道适配器实现并可成功调用实时汇率API
- [ ] BOCHK通道适配器实现并可成功爬取汇率数据
- [ ] Leptage通道适配器实现并可成功调用询价API
- [ ] Cron Job每分钟自动采集72个法币币种对和4个数字货币币种对
- [ ] 采集的汇率写入PostgreSQL历史表
- [ ] 最新汇率更新到Redis缓存（TTL 5分钟）
- [ ] 采集失败时记录错误日志并告警

## Technical Details

- 实现ExchangeChannel接口的三个适配器
- 使用@nestjs/schedule实现Cron Job
- 采集逻辑支持并发调用三个通道
- Redis缓存key格式：`rate:{channelId}:{currencyPair}`
- 发布RateUpdated事件到消息队列

## Effort Estimate

**Size:** M (Medium)
**Duration:** 2-3天
**Parallel:** false
